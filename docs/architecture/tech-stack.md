# 技术栈架构

**注意**：本节记录实际使用的技术栈，基于 package.json 和代码分析。这是一个成熟的企业级技术栈，支持多链、实时监控和高安全性要求。

## 基础设施和部署

- **部署模式**：NPM 包，本地 CLI 工具
- **运行环境**：用户本地机器，无服务器依赖
- **RPC 提供商**：Alchemy（主要）+ 直连 RPC（备用）
- **代理支持**：全局 HTTP 代理配置（国际用户支持）
- **发布渠道**：NPM Registry (opensea-offer-maker@0.0.6)

## 核心技术栈

| 类别 | 技术 | 版本 | 核心用途 | 关键特性/约束 |
|------|------|------|----------|--------------|
| **运行时** | Node.js | 16+ | JavaScript 执行环境 | ES Modules 支持，事件循环 |
| **包管理** | npm | - | 依赖管理和发布 | lockfile 确保一致性 |
| **语言** | JavaScript | ES2022 | 主要编程语言 | 动态类型，函数式编程 |
| **模块系统** | ES Modules | - | 模块导入/导出 | type: "module" 配置 |

### CLI 和用户交互

| 技术 | 版本 | 用途 | 实际应用 |
|------|------|------|----------|
| **commander.js** | ^12.1.0 | CLI 框架 | 15个命令，参数解析 |
| **enquirer** | ^2.4.1 | 交互式提示 | 密钥输入，选择菜单 |
| **dotenv** | ^16.4.5 | 环境配置 | API密钥管理，启动验证 |

### 区块链和 Web3 技术栈

| 技术 | 版本 | 用途 | 集成方式 |
|------|------|------|----------|
| **ethers.js** | ^6.15.0 | 区块链交互 | 钱包管理，合约调用，交易签名 |
| **opensea-js** | ^8.0.3 | OpenSea 集成 | 出价创建，订单管理 |
| **@opensea/seaport-js** | ^4.0.5 | Seaport 协议 | 低级订单构建，协议合规 |
| **@opensea/stream-js** | ^0.2.1 | 实时事件流 | WebSocket 连接，事件监听 |

### 网络和通信

| 技术 | 版本 | 用途 | 特性 |
|------|------|------|------|
| **axios** | ^1.12.2 | HTTP 客户端 | API 调用，重试机制，代理支持 |
| **https-proxy-agent** | ^7.0.6 | HTTPS 代理 | 国际网络访问支持 |
| **ws** | ^8.18.3 | WebSocket 客户端 | 实时数据流连接 |
| **global-agent** | ^3.0.0 | 全局代理 | 系统级网络代理配置 |

### 数据存储和缓存

| 技术 | 版本 | 用途 | 存储格式 |
|------|------|------|----------|
| **node-localstorage** | ^3.0.5 | 本地存储 | 浏览器兼容的 localStorage |
| **文件系统** | Node.js 内置 | 缓存系统 | JSON, JSONL 格式 |
| **加密存储** | Node.js crypto | 安全存储 | AES-256-GCM 加密 |

### 测试和质量保证

| 技术 | 版本 | 用途 | 配置特点 |
|------|------|------|----------|
| **Jest** | ^29.7.0 | 测试框架 | 实验性 VM 模块，84.36% 覆盖率 |
| **Babel** | @babel/preset-env ^7.26.0 | JavaScript 转译 | 测试环境兼容性 |
| **ESLint** | ^9.38.0 | 代码规范 | 自动化代码检查和修复 |

## 技术架构决策分析

### 技术选型优势

1. **现代化技术栈**
   - ES Modules 支持清晰的模块边界
   - ethers.js v6 提供最新的 Web3 功能
   - 原生 WebSocket 和 fetch API 性能优化

2. **企业级可靠性**
   - 成熟的 OpenSea SDK 生态系统
   - 多层代理支持国际用户访问
   - 全面的测试覆盖和错误处理

3. **开发体验优化**
   - Commander.js 提供标准的 CLI 模式
   - 交互式提示提升用户体验
   - 环境验证确保配置正确性

### 技术约束和限制

1. **Node.js 版本要求**
   - 需要 Node.js 16+ LTS 支持
   - ES Modules 需要现代 Node.js 环境

2. **网络依赖**
   - 强依赖外部 API（OpenSea, Alchemy）
   - 代理配置复杂性（国际化需求）

3. **测试配置复杂性**
   - Jest 需要实验性标志支持 ES 模块
   - 集成测试需要真实 API 密钥

## 性能和扩展性特征

### 性能优势

- **异步 I/O**：Node.js 事件循环处理并发
- **缓存系统**：减少重复 API 调用
- **连接复用**：WebSocket 持久连接
- **轻量级**：无服务器架构，快速启动

### 扩展性考虑

- **多链支持**：配置驱动的链扩展
- **模块化设计**：新功能易于集成
- **插件架构**：服务层支持功能扩展

## 安全技术栈

### 加密和安全

- **AES-256-GCM**：私钥加密存储
- **环境变量**：敏感信息隔离
- **代理支持**：安全网络传输
- **输入验证**：参数和配置验证

### 依赖安全性

- **定期更新**：依赖版本管理
- **安全扫描**：npm audit 集成
- **最小权限**：API 权限控制

## 技术债务和改进机会

### 当前技术债务

1. **硬编码配置**
   - 加密盐和密码在源代码中
   - 默认代理设置硬编码

2. **测试配置**
   - Jest 需要实验性标志
   - 集成测试依赖真实 API

3. **依赖管理**
   - 部分依赖可以更新到最新版本
   - 某些包可能存在更轻量的替代方案

### 改进建议

1. **配置外部化**
   - 将加密配置移到环境变量
   - 支持配置文件定制

2. **测试优化**
   - 添加更多 Mock 测试
   - 减少对真实 API 的依赖

3. **性能优化**
   - 考虑使用更轻量的 HTTP 客户端
   - 优化缓存策略

## 版本兼容性

### Node.js 兼容性

- **最低版本**：Node.js 16.0.0
- **推荐版本**：Node.js 18+ LTS
- **测试版本**：Node.js 18, 20 LTS

### 操作系统支持

- **Windows**：完全支持（包括代理配置）
- **macOS**：完全支持
- **Linux**：完全支持（推荐服务器环境）

### Web3 兼容性

- **以太坊主网**：完全支持
- **Layer 2**：Base, Arbitrum, Polygon 完全支持
- **其他链**：Ronin, ApeChain, Sepolia 测试网支持